<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Agent Pattern Library</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root{--bg:#0a0a0f;--fg:#d0d0d0;--muted:#555;--accent:#00f0ff;--border:#1a1a2e}
    [data-theme=light]{--bg:#f5f5f7;--fg:#1a1a1a;--muted:#777;--accent:#0066cc;--border:#ddd}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font:15px/1.8 'JetBrains Mono',monospace;background:var(--bg);color:var(--fg)}
    .wrap{max-width:1200px;margin:0 auto;padding:2rem 1rem;display:grid;grid-template-columns:1fr;gap:2rem}
    @media(min-width:900px){.wrap{grid-template-columns:1fr 200px}.has-toc{grid-template-columns:1fr 200px}}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    h1,h2,h3,h4{font-family:'Orbitron',sans-serif;font-weight:700;letter-spacing:.05em;text-transform:uppercase;margin:2.5rem 0 1rem}
    h1{font-size:1.4rem;color:var(--accent)}
    h2{font-size:1.1rem;color:var(--accent);border-bottom:1px solid var(--border);padding-bottom:.5rem}
    h3{font-size:.95rem;color:var(--fg)}
    h4{font-size:.85rem;color:var(--muted)}
    p,ul,ol,table,pre,blockquote{margin:0 0 1.2rem}
    ul,ol{padding-left:1.5rem}
    li{margin:.3rem 0}
    li>ul,li>ol{margin:0}
    code{background:var(--border);padding:.15em .4em;font-size:.9em;border-radius:3px}
    pre{background:var(--border);padding:1rem;overflow-x:auto;font-size:.85em;border-radius:4px;border-left:3px solid var(--accent)}
    pre code{background:none;padding:0}
    table{width:100%;border-collapse:collapse;font-size:.9em}
    th,td{text-align:left;padding:.6rem;border-bottom:1px solid var(--border)}
    th{color:var(--accent);font-family:'Orbitron',sans-serif;font-size:.75rem;text-transform:uppercase;letter-spacing:.1em}
    blockquote{border-left:3px solid var(--accent);padding-left:1rem;color:var(--muted);font-style:italic}
    hr{border:0;border-top:1px solid var(--border);margin:2rem 0}
    nav{grid-column:1/-1;padding-bottom:1rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-family:'Orbitron',sans-serif;font-size:.8rem;text-transform:uppercase;letter-spacing:.1em}
    nav a{color:var(--muted);margin-right:1.5rem}
    nav a:hover,nav a.active{color:var(--accent);text-decoration:none}
    #theme,#repo{cursor:pointer;background:0;border:1px solid var(--border);color:var(--muted);font:inherit;padding:.3rem .6rem;border-radius:3px;font-family:'Orbitron',sans-serif;font-size:.7rem;text-transform:uppercase;letter-spacing:.1em}
    #theme{margin-left:.5rem}
    #theme:hover,#repo:hover{color:var(--accent);border-color:var(--accent);text-decoration:none}
    a:focus-visible,button:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
    @media(prefers-reduced-motion:reduce){*{transition:none!important}}
    #content{min-height:60vh;max-width:72ch}
    #toc{display:none}
    @media(min-width:900px){#toc{display:block;position:sticky;top:2rem;align-self:start;font-size:.75rem;max-height:calc(100vh - 4rem);overflow-y:auto}}
    #toc h4{font-size:.65rem;color:var(--muted);margin:0 0 .75rem;border:0}
    #toc ul{list-style:none;padding:0;margin:0}
    #toc li{margin:.4rem 0;line-height:1.4}
    #toc a{color:var(--muted);text-decoration:none;display:block;transition:color .2s}
    #toc a:hover,#toc a.active{color:var(--accent)}
    #toc .h3{padding-left:.75rem}
    #toc .h4{padding-left:1.5rem}
    .patterns{list-style:none;padding:0}
    .patterns li{padding:.8rem 0;border-bottom:1px solid var(--border)}
    .patterns a{font-family:'Orbitron',sans-serif;font-size:.85rem;text-transform:uppercase;letter-spacing:.05em}
    .patterns small{display:block;color:var(--muted);font-size:.8em;margin-top:.3rem;text-transform:none;letter-spacing:0}
    footer{grid-column:1/-1;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);color:var(--muted);font-size:.8em;font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:.1em}
  </style>
</head>
<body>
  <div class="wrap">
    <nav>
      <div><a href="#" data-page="readme" class="active">Home</a><a href="#patterns" data-page="patterns">Patterns</a></div>
      <div><a href="https://github.com/jackrwstevenson/agent-pattern-library" target="_blank" rel="noopener" id="repo">GitHub</a><button id="theme" aria-label="Toggle dark mode">Light</button></div>
    </nav>
    <main id="content"></main>
    <aside id="toc"></aside>
    <footer>Agent Pattern Library</footer>
  </div>
  <script type="module">
const BASE='https://raw.githubusercontent.com/jackrwstevenson/agent-pattern-library/main/'
const PATTERNS=[
  ['throwaway-spike','Throwaway Spike','Rapid prototypes with explicit constraints and human decision gates'],
  ['code-archaeologist','Code Archaeologist','Reverse-engineer legacy codebases before replacement'],
  ['context-library','Context Library','Reference material agents consult to understand WHAT good looks like'],
  ['skills-library','Skills Library','Executable skills that define HOW to perform tasks'],
  ['specify-plan-ship','Specify Plan Ship','Three-phase workflow with documents and verification gates'],
  ['regen','Regen','Treat specs and implementations as regenerable functions of inputs'],
  ['golden-path-anchor','Golden Path Anchor','Reference apps that actively propagate best practices'],
  ['authoritative-source-anchor','Authoritative Source Anchor','Embed external specs so agents cite rather than recall'],
  ['detached-agent','Detached Agent','Issue trackers as task queues for sandboxed cloud agents'],
  ['autonomous-agent','Autonomous Agent','Agents that select tasks and monitor outcomes'],
  ['agent-swarm','Agent Swarm','Hierarchical swarms with planning and worker agents'],
  ['context-bypass','Context Bypass','Delegate data-heavy ops to local APIs'],
  ['spec-library','Spec Library','Distribute specs and tests; generate implementations on demand']
]
const $=s=>document.querySelector(s)
const slugify=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'')
const prefersReducedMotion=()=>window.matchMedia('(prefers-reduced-motion:reduce)').matches
const scrollBehavior=()=>prefersReducedMotion()?'auto':'smooth'

const buildToc=()=>{
  const headings=$('#content').querySelectorAll('h2,h3,h4')
  if(headings.length<2){$('#toc').innerHTML='';return}
  let html='<h4>On this page</h4><ul>'
  headings.forEach(h=>{
    const id=slugify(h.textContent)
    h.id=id
    html+=`<li><a href="#${id}" class="${h.tagName.toLowerCase()}">${h.textContent}</a></li>`
  })
  html+='</ul>'
  $('#toc').innerHTML=html
}

const highlightToc=()=>{
  const headings=[...$('#content').querySelectorAll('h2,h3,h4')]
  if(!headings.length)return
  let current=headings[0].id
  for(const h of headings){
    if(h.getBoundingClientRect().top<=100)current=h.id
  }
  $('#toc').querySelectorAll('a').forEach(a=>{
    a.classList.toggle('active',a.getAttribute('href')==='#'+current)
  })
}

const render=async p=>{
  if(p==='patterns'){
    $('#content').innerHTML='<h1>Patterns</h1><ul class="patterns">'+PATTERNS.map(([id,name,desc])=>`<li><a href="#${id}" data-pattern="${id}">${name}</a><small>${desc}</small></li>`).join('')+'</ul>'
    $('#toc').innerHTML=''
    return
  }
  const url=p==='readme'?BASE+'README.md':BASE+'patterns/'+p+'.md'
  try{
    const r=await fetch(url)
    if(!r.ok)throw new Error()
    $('#content').innerHTML=marked.parse(await r.text())
    // Rewrite pattern links to hash links
    $('#content').querySelectorAll('a[href^="patterns/"]').forEach(a=>{
      const match=a.getAttribute('href').match(/patterns\/([^.]+)\.md/)
      if(match)a.setAttribute('href','#'+match[1])
    })
    buildToc()
  }catch{$('#content').innerHTML='<p>Failed to load content</p>';$('#toc').innerHTML=''}
}

const route=()=>{
  const h=location.hash.slice(1)||'readme'
  const isPattern=PATTERNS.some(p=>p[0]===h)
  if(!isPattern&&h!=='readme'&&h!=='patterns'){
    const el=document.getElementById(h)
    if(el){el.scrollIntoView({behavior:scrollBehavior()});return}
  }
  document.querySelectorAll('nav a').forEach(a=>a.classList.toggle('active',a.dataset.page===h||a.dataset.page==='patterns'&&isPattern))
  render(h)
  window.scrollTo(0,0)
}

$('#theme').onclick=()=>{
  const isLight=document.documentElement.dataset.theme==='light'
  document.documentElement.dataset.theme=isLight?'':'light'
  $('#theme').textContent=isLight?'Light':'Dark'
  localStorage.theme=document.documentElement.dataset.theme
}
if(localStorage.theme){
  document.documentElement.dataset.theme=localStorage.theme
  $('#theme').textContent=localStorage.theme==='light'?'Dark':'Light'
}

$('#content').onclick=e=>{if(e.target.dataset.pattern){e.preventDefault();location.hash=e.target.dataset.pattern}}
$('#toc').onclick=e=>{
  if(e.target.tagName==='A'){
    e.preventDefault()
    const id=e.target.getAttribute('href').slice(1)
    document.getElementById(id)?.scrollIntoView({behavior:scrollBehavior()})
    history.pushState(null,null,'#'+id)
  }
}
window.addEventListener('scroll',highlightToc,{passive:true})
window.onhashchange=route
route()
  </script>
</body>
</html>
